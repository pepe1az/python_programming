# Отчёт по лабораторной работе №8

## Тема работы

Создание клиент-серверного приложения на Python без серверных фреймворков с использованием `HTTPServer`, шаблонизатора **Jinja2** и архитектуры **MVC**.

---

## 1. Цель работы

Целью данной лабораторной работы является:

* создание простого клиент-серверного приложения на Python без использования серверных фреймворков;
* освоение работы с `HTTPServer` и маршрутизацией HTTP-запросов;
* применение шаблонизатора **Jinja2** для отображения данных;
* реализация моделей предметной области (`User`, `Currency`, `UserCurrency`, `App`, `Author`) с использованием геттеров и сеттеров;
* структурирование проекта в соответствии с архитектурой **MVC**;
* получение данных о курсах валют через функцию `get_currencies` и отображение их пользователям;
* реализация функциональности подписки пользователей на валюты;
* ознакомление с методами тестирования моделей и серверной логики.

---

## 2. Описание предметной области

### 2.1 Author

Модель описывает автора приложения.

**Поля:**

* `name` — имя автора;
* `group` — учебная группа.

---

### 2.2 App

Модель описывает приложение.

**Поля:**

* `name` — название приложения;
* `version` — версия приложения;
* `author` — объект класса `Author`.

---

### 2.3 User

Модель описывает пользователя системы.

**Поля:**

* `id` — уникальный идентификатор пользователя;
* `name` — имя пользователя.

---

### 2.4 Currency

Модель описывает валюту.

**Поля:**

* `id` — уникальный идентификатор валюты;
* `num_code` — цифровой код валюты;
* `char_code` — символьный код валюты;
* `name` — название валюты;
* `value` — курс валюты;
* `nominal` — номинал валюты.

Данные о валютах соответствуют структуре, используемой ЦБ РФ.

---

### 2.5 UserCurrency

Модель реализует связь «многие ко многим» между пользователями и валютами.

**Поля:**

* `id` — уникальный идентификатор;
* `user_id` — внешний ключ к `User`;
* `currency_id` — внешний ключ к `Currency`.

---

## 3. Архитектура проекта (MVC)

Проект реализован в соответствии с архитектурным паттерном **Model–View–Controller**.

* **Models** — классы предметной области, реализующие хранение данных, геттеры и сеттеры.
* **Views** — HTML-шаблоны Jinja2, отвечающие за отображение данных пользователю.
* **Controller** — HTTP-сервер на базе `HTTPServer` и `BaseHTTPRequestHandler`, выполняющий маршрутизацию запросов.

---

## 4. Структура проекта

```
myapp/
├── models/
│   ├── __init__.py
│   ├── author.py
│   ├── app.py
│   ├── user.py
│   ├── currency.py
│   └── user_currency.py
├── utils/
│   ├── currencies_api.py
│   └── history.py
├── templates/
│   ├── index.html
│   ├── users.html
│   ├── user.html
│   ├── currencies.html
│   └── author.html
├── static/
│   └── style.css
└── myapp.py
```

Такое разделение упрощает поддержку, тестирование и расширение приложения.

---

## 5. Реализация серверной части

Для реализации сервера используется стандартный модуль `http.server`:

* `HTTPServer` — запуск HTTP-сервера;
* `BaseHTTPRequestHandler` — обработка HTTP-запросов.

### Реализованные маршруты

| Маршрут        | Назначение                                |
| -------------- | ----------------------------------------- |
| `/`            | Главная страница приложения               |
| `/users`       | Список пользователей                      |
| `/user?id=...` | Информация о пользователе и его подписках |
| `/currencies`  | Список валют и их текущие курсы           |
| `/author`      | Информация об авторе                      |

Маршрутизация реализована через анализ `self.path` и `urllib.parse.parse_qs`.

---

## 6. Использование шаблонизатора Jinja2

Шаблоны находятся в папке `templates/`.

Инициализация Jinja2 выполняется **один раз при старте приложения**:

```python
env = Environment(
    loader=PackageLoader("myapp", "templates"),
    autoescape=select_autoescape()
)
```

Это позволяет:

* использовать кэш шаблонов;
* повысить производительность;
* многократно рендерить шаблоны с разными данными.

---

## 7. Работа с API курсов валют

Для получения актуальных курсов валют используется функция `get_currencies`, реализованная ранее.

Основные этапы интеграции:

* получение курсов валют по символьным кодам;
* обновление значений в моделях `Currency`;
* сохранение истории изменений курсов;
* отображение данных на странице `/currencies`.

Обновление курсов выполняется при каждом обращении к странице `/currencies` или вручную по кнопке «Обновить».

---

## 8. Подписки пользователей и динамика курсов

Пользователь может подписываться на валюты. Подписки реализованы через сущность `UserCurrency`.

На странице `/user?id=...`:

* отображается список валют, на которые подписан пользователь;
* реализована возможность подписки и отписки;
* дополнительно отображается график изменения курсов валют за последние три месяца.

Для визуализации динамики используется библиотека **Chart.js**.

---

## 9. Тестирование

### 9.1 Тестирование моделей

Проверяются:

* корректная работа геттеров и сеттеров;
* выброс исключений при некорректных данных.

### 9.2 Тестирование функции `get_currencies`

Проверяется:

* корректное получение курсов валют;
* выброс исключений `ConnectionError`, `ValueError`, `KeyError` при ошибках.

### 9.3 Тестирование контроллера

Проверяется:

* корректный ответ сервера на маршруты `/`, `/users`, `/currencies`;
* обработка query-параметров (`/user?id=...`).

### 9.4 Тестирование шаблонов

Проверяется:

* корректная передача переменных в шаблоны;
* корректная работа циклов и условий.

---

## 10. Примеры работы приложения

В ходе работы были получены следующие результаты:

* главная страница с информацией о приложении и авторе;
* страница списка пользователей;
* страница валют с актуальными курсами;
* страница пользователя с подписками и графиком динамики курсов.

В отчёте приведены скриншоты соответствующих страниц.

---

## 11. Выводы

В ходе выполнения лабораторной работы:

* было создано клиент-серверное приложение без использования серверных фреймворков;
* на практике освоена работа с `HTTPServer` и маршрутизацией HTTP-запросов;
* применён шаблонизатор Jinja2 для формирования HTML-страниц;
* реализована архитектура MVC и разделение ответственности между компонентами;
* получен практический опыт работы с внешним API курсов валют;
* изучены основы тестирования серверной логики и моделей.

Полученные знания позволяют лучше понимать принципы построения серверных приложений на Python и использовать их в более сложных проектах.
